---
title: rustå­¦ä¹ ç¬”è®°ï¼ˆ1ï¼‰ï¼šDay1 Moring
date: 2023-01-02 11:19:15
tags:
- Rust
- å­¦ä¹ ç¬”è®°
categories: Rust
---

ä¸‹é¢ç¬”è®°éƒ½æ˜¯ä½¿ç”¨Windowsç³»ç»Ÿ

<!-- more -->

## ç¯å¢ƒé…ç½®

é¦–å…ˆéœ€è¦å®‰è£…Rustupå’Œmingw-w64ï¼Œå…¶ä¸­Rustupç”¨äºå®‰è£…Rustç¼–è¯‘å™¨å’ŒCargoï¼Œç¼–è¯‘å‡ºå¯æ‰§è¡Œæ–‡ä»¶è¿˜éœ€è¦mingw-w64è¿›è¡Œè¿æ¥ï¼Œå½“ç„¶å¦‚æœä½ çš„ç”µè„‘æœ‰è£…VSè€Œä¸”è£…msvcç¼–è¯‘å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨mingwã€‚

### å®‰è£…Rustup

å¦‚æœä½ çš„ç³»ç»Ÿå·²ç»å®‰è£…äº†Chocolatey æˆ–è€… Scoop,å¯ä»¥ä½¿ç”¨ä»–ä»¬å®‰è£…Rustupï¼Œæˆ‘å°±ä¸ºäº†æ–¹ä¾¿å°±ç”¨ç³»ç»Ÿè‡ªå¸¦çš„Wingetæ¥å®‰è£…äº†ï¼š

```
winget install rustup
```

ç„¶åå®‰è£…å·¥å…·é“¾çš„è¯ï¼Œå¦‚æœä½ çš„ç”µè„‘æœ‰msvcï¼Œå°±ä¸‹ä½¿ç”¨msvcçš„å·¥å…·é“¾ï¼š

```
rustup toolchain install stable-x86_64-pc-windows-msvc
```

å¦‚æœä½ çš„ç”µè„‘æ²¡æœ‰msvcï¼Œæ¨èä½¿ç”¨mingwï¼Œæ›´åŠ å°å·§è€Œä¸”å®‰è£…æ–¹ä¾¿ï¼š

```
rustup toolchain install stable-x86_64-pc-windows-gnu
```

å·¥å…·é“¾ä¹Ÿå¯ä»¥å®‰è£…å¤šä¸ªï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•åˆ‡æ¢ï¼š

```
# åˆ‡åˆ°mingw
rustup default stable-x86_64-pc-windows-gnu
# åˆ‡åˆ°msvc
rustup default stable-x86_64-pc-windows-msvc
```

### å®‰è£…Mingw

å¦‚æœä½ çš„ç”µè„‘æ²¡æœ‰msvcï¼Œå¯ä»¥é€‰æ‹©å®‰è£…mingwï¼Œå½“ç„¶ä½ è¦è£…msvcä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯å› ä¸ºæˆ‘æ˜¯ä½¿ç”¨mingwæ‰€ä»¥ä¸‹é¢æ•™ç¨‹éƒ½æ˜¯ä½¿ç”¨mingwã€‚

æ‰“å¼€[mingwçš„github releaseé¡µé¢](https://github.com/niXman/mingw-builds-binaries/releases)ï¼Œé€‰æ‹©æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚å†™è¿™ç¯‡ç¬”è®°æ—¶æœ€æ–°æ˜¯12.2.0ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç‚¹å‡»Assetsä¸‹é¢çš„ï¼š`x86_64-12.2.0-release-posix-seh-msvcrt-rt_v10-rev2.7z` è¿›è¡Œä¸‹è½½ã€‚

ä¸‹è½½å®Œæˆåæˆ‘ä»¬å¯ä»¥æ‰¾ä¸ªä½ç½®å­˜æ”¾ï¼Œæ¯”å¦‚æˆ‘æ”¾åˆ°äº†ï¼š`E:\Program Files\mingw64`

ç„¶åæ‰“å¼€ç¯å¢ƒå˜é‡é…ç½®ï¼Œåœ¨PathåŠ å…¥ï¼š`E:\Program Files\mingw64\bin` åˆ«æ¼æ‰æœ€åé¢çš„binç›®å½•å“¦

## åˆ›å»ºRusté¡¹ç›®

æˆ‘ä½¿ç”¨çš„æ˜¯ClionåŠ Rustæ’ä»¶ï¼Œå½“ç„¶å¦‚æœæ²¡æœ‰ä¹°jetbrainsäº§å“çš„è¯ä¹Ÿå¯ä»¥ä½¿ç”¨Ideaç¤¾åŒºç‰ˆç„¶åå®‰è£…rustæ’ä»¶ã€‚

å®‰è£…å®ŒRustæ’ä»¶ä¹‹åï¼Œæ–°å»ºé¡¹ç›®å°±ä¼šæœ‰Rusté€‰é¡¹ï¼Œé€‰æ‹©å·¥å…·é“¾ä½ç½®ï¼Œå¦‚æœå·²ç»å¼¹å‡ºæ¥é‚£å°±å¯ä»¥ä¸ç”¨è‡ªå·±æ‰‹é€‰ï¼Œå¦‚æœæ˜¯æ²¡æœ‰çš„è¯ï¼Œåº”è¯¥æ˜¯åœ¨ï¼š`C:\Users\ä½ çš„ç”¨æˆ·å\.cargo\bin`

ä¸‹é¢æœ‰ä¸ªæ ‡å‡†åº“ä¸çŸ¥é“æœ‰æ²¡æœ‰ç”¨ï¼Œåæ­£æˆ‘ç‚¹äº†ä¸‹é¢çš„ä¸‹è½½æŒ‰é’®ä¹‹åå°±å¼¹å‡ºæ¥äº†ã€‚

åˆ›å»ºå®Œæˆåé¡¹ç›®æœ‰ä¸€ä¸ªmain.rsï¼š

```rust
fn main() {
    println!("Hello, world!");
}
```

ç‚¹å‡»è¿è¡ŒæˆåŠŸæ‰“å°ï¼š`Hello, world!`

## Cargoä½¿ç”¨

å¦‚æœåœ¨ç»ˆç«¯è¿è¡Œçš„è¯ï¼Œåªéœ€è¦æ‰§è¡Œï¼š`cargo run`

å¦‚æœéœ€è¦æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶åªéœ€è¦ï¼š`cargo build`ï¼Œå¦‚æœéœ€è¦ä¼˜åŒ–å¯æ‰§è¡Œæ–‡ä»¶å°±åŠ ä¸Šé€‰é¡¹ï¼š`cargo build --release`

## Hello World

é¦–å…ˆçœ‹çœ‹ä¸Šé¢æåˆ°çš„ä»£ç ï¼š

```rust
fn main() {
    println!("Hello ğŸŒ!");
}
```

* å‡½æ•°é€šè¿‡fnå¼•å…¥ã€‚
* åƒåœ¨Cå’Œc++ä¸­ä¸€æ ·ï¼Œå—ç”±èŠ±æ‹¬å·åˆ†éš”ã€‚
* mainå‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ç‚¹ã€‚
* Rustæœ‰å«ç”Ÿå®ï¼Œ`println!`å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚
* Rustå­—ç¬¦ä¸²æ˜¯UTF-8ç¼–ç çš„ï¼Œå¯ä»¥åŒ…å«ä»»ä½•Unicodeå­—ç¬¦ã€‚

### ç®€å•ç¤ºä¾‹

```rust
fn main() {              // ç¨‹åºå…¥å£
    let mut x: i32 = 6;  // å¯å˜å˜é‡ç»‘å®š
    print!("{x}");       // ä½¿ç”¨å®æ‰“å°ï¼Œç±»ä¼¼printf
    while x != 1 {       // è¡¨è¾¾å¼ä¸éœ€è¦åœ†æ‹¬å·
        if x % 2 == 0 {  // åƒå…¶ä»–è¯­è¨€ä¸€æ ·è¿›è¡Œæ•°å­¦è¿ç®—
            x = x / 2;
        } else {
            x = 3 * x + 1;
        }
        print!(" -> {x}");
    }
    println!();
}
```

## ä¸ºä»€ä¹ˆä½¿ç”¨Rust

* ç¼–è¯‘æ—¶å†…å­˜å®‰å…¨ã€‚
* ç¼ºä¹æœªå®šä¹‰çš„è¿è¡Œæ—¶è¡Œä¸ºã€‚
* ç°ä»£è¯­è¨€ç‰¹å¾ã€‚

### ç¼–è¯‘æ—¶ä¿è¯

ç¼–è¯‘æ—¶çš„é™æ€å†…å­˜ç®¡ç†ï¼š

* æ²¡æœ‰æœªåˆå§‹åŒ–çš„å˜é‡ã€‚
* åŸºæœ¬ä¸Šæ²¡æœ‰å†…å­˜æ³„æ¼ã€‚
* æ²¡æœ‰double-freesã€‚
* æ²¡æœ‰use-after-freeã€‚
* æ²¡æœ‰ç©ºæŒ‡é’ˆã€‚
* æ²¡æœ‰è¢«é—å¿˜çš„é”å®šäº’æ–¥å¯¹è±¡ã€‚
* çº¿ç¨‹ä¹‹é—´æ²¡æœ‰æ•°æ®äº‰ç”¨ã€‚
* æ²¡æœ‰è¿­ä»£å™¨å¤±æ•ˆã€‚

ä»æŠ€æœ¯ä¸Šè®²ï¼Œåœ¨(å®‰å…¨çš„)Rustä¸­äº§ç”Ÿå†…å­˜æ³„æ¼æ˜¯å¯èƒ½çš„ã€‚`Box::leak`æ–¹æ³•å…è®¸ä»Boxä¸­è·å–åŸå§‹å¼•ç”¨ï¼Œç„¶ååœ¨ä¸è¿è¡Œææ„å‡½æ•°çš„æƒ…å†µä¸‹åˆ é™¤Boxã€‚è¿™å¯ä»¥ç”¨äºè·å¾—è¿è¡Œæ—¶åˆå§‹åŒ–å’Œè¿è¡Œæ—¶å¤§å°çš„é™æ€å˜é‡ã€‚æˆ–è€…ç®€å•åœ°è¯´ï¼Œ`std::mem::forget`å‡½æ•°ï¼Œå®ƒä½¿ç¼–è¯‘å™¨å¿˜è®°ä¸€ä¸ªå€¼ï¼Œè¿™æ„å‘³ç€ææ„å‡½æ•°æ°¸è¿œä¸ä¼šè¿è¡Œã€‚åœ¨å®‰å…¨çš„Rustä¸­æœ‰è®¸å¤šå…¶ä»–çš„æ–¹æ³•æ¥åˆ›å»ºæ³„æ¼ï¼Œä½†æ˜¯ä¸ºäº†æœ¬è¯¾ç¨‹çš„ç›®çš„ï¼Œæ²¡æœ‰å†…å­˜æ³„æ¼åº”è¯¥è¢«ç†è§£ä¸ºå‡ ä¹æ²¡æœ‰æ„å¤–çš„å†…å­˜æ³„æ¼ã€‚

### è¿è¡Œæ—¶ä¿è¯

è¿è¡Œæ—¶æ²¡æœ‰æœªå®šä¹‰çš„è¡Œä¸º:

* æ•°ç»„è®¿é—®æ˜¯è¾¹ç•Œæ£€æŸ¥ã€‚
* å®šä¹‰äº†æ•´æ•°æº¢å‡ºã€‚

### ç°ä»£ç‰¹æ€§

Rustæ˜¯åœ¨è¿‡å»40å¹´é‡Œç§¯ç´¯çš„ç»éªŒã€‚

### è¯­è¨€ç‰¹æ€§

* æšä¸¾å’Œæ¨¡å¼åŒ¹é…ã€‚
* æ³›å‹ã€‚
* æ²¡æœ‰å¼€é”€çš„FFIã€‚

### å·¥å…·

* éå¸¸è‰¯å¥½çš„ç¼–è¯‘å™¨é”™è¯¯æç¤ºã€‚
* å†…ç½®ä¾èµ–ç®¡ç†å™¨ã€‚
* å†…ç½®æµ‹è¯•æ”¯æŒã€‚

## åŸºç¡€è¯­æ³•

Rustçš„å¾ˆå¤šè¯­æ³•å¯¹æ‚¨æ¥è¯´éƒ½æ˜¯ç†Ÿæ‚‰çš„Cæˆ–c++è¯­æ³•ï¼š

* å—å’ŒèŒƒå›´ç”±èŠ±æ‹¬å·åˆ†éš”ã€‚
* è¡Œæ³¨é‡Šä½¿ç”¨ `//` å¼€å§‹ï¼Œå—æ³¨é‡Šä½¿ç”¨ï¼š `/* ... */`
* å…³é”®å­—å¦‚ifå’Œwhileçš„ä½œç”¨ç›¸åŒã€‚
* å˜é‡èµ‹å€¼ç”¨`=`ï¼Œæ¯”è¾ƒç”¨`==`ã€‚

### åŸºç¡€ç±»å‹

| åˆ†ç±» | ç±»å‹ | å­—é¢é‡ |
| - | - | - |
| å¸¦ç¬¦å·æ•´æ•° | i8, i16, i32, i64, i128, isize | -10, 0, 1_000, 123i64 |
| æ— ç¬¦å·æ•´æ•° | u8, u16, u32, u64, u128, usize | 0, 123, 10u16 |
| æµ®ç‚¹æ•° | f32, f64 | 3.14, -10.0e20, 2f32 |
| å­—ç¬¦ä¸² | &str | "foo", `r#"\\"#` |
| Unicodeæ ‡é‡å€¼ | char | 'a', 'Î±', 'âˆ' |
| å­—èŠ‚å­—ç¬¦ä¸² | `&[u8]` | b"abc", `br#" " "#` |
| å¸ƒå°”å€¼ | bool | true, false |

ç±»å‹çš„å®½åº¦å¦‚ä¸‹æ‰€ç¤ºï¼š

* iNã€uNå’ŒfNçš„å®½åº¦ä¸ºNä½
* isize å’Œ usize æ˜¯æŒ‡é’ˆçš„å®½åº¦
* char æ˜¯ 32 ä½å®½
* bool æ˜¯ 8 ä½å®½

### å¤åˆç±»å‹

| åˆ†ç±» | ç±»å‹ | å­—é¢é‡ |
| - | - | - |
| æ•°ç»„ | [T; N] | [20, 30, 40], [0; 3] |
| å…ƒç»„ | (T1, T2, T3, ...) | ('x', 1.2, 0) |

æ•°ç»„åˆ†é…å’Œè®¿é—®:

```rust
fn main() {
    let mut a: [i8; 10] = [42; 10];
    a[5] = 0;
    println!("a: {:?}", a);
}
```

å…ƒç»„åˆ†é…å’Œè®¿é—®:

```rust
fn main() {
    let t: (i8, bool) = (7, true);
    println!("1st index: {}", t.0);
    println!("2nd index: {}", t.1);
}
```

### å¼•ç”¨

ç±»ä¼¼C++ï¼ŒRustè¿™æ ·å¼•ç”¨ï¼š

```rust
fn main() {
    let mut x: i32 = 10;
    let ref_x: &mut i32 = &mut x;
    *ref_x = 20;
    println!("x: {x}");
}
```

å’ŒC++ä¸ä¸€æ ·çš„åœ°æ–¹ï¼š

* åœ¨ç»™`ref_x`èµ‹å€¼æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è§£å¼•ç”¨å®ƒï¼Œç±»ä¼¼äºCæŒ‡é’ˆ
* Ruståœ¨æŸäº›æƒ…å†µä¸‹ä¼šè‡ªåŠ¨è§£å¼•ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒç”¨æ–¹æ³•æ—¶(å°è¯•`count_ones`)ã€‚

#### æ‚¬ç©ºå¼•ç”¨

Rustå°†é™æ€ç¦æ­¢æ‚¬ç©ºå¼•ç”¨

```rust
fn main() {
    let ref_x: &i32;
    {
        let x: i32 = 10;
        ref_x = &x; // æŠ¥é”™ï¼šborrowed value does not live long enough
    }
    println!("ref_x: {ref_x}");
}
```

* å¼•ç”¨è¢«ç§°ä¸ºå€Ÿç”¨å®ƒæ‰€å¼•ç”¨çš„å€¼ã€‚
* Rustæ­£åœ¨è·Ÿè¸ªæ‰€æœ‰å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥ç¡®ä¿å®ƒä»¬çš„ç”Ÿå­˜æ—¶é—´è¶³å¤Ÿé•¿ã€‚
* å½“æˆ‘ä»¬è®²åˆ°æ‰€æœ‰æƒæ—¶ï¼Œæˆ‘ä»¬ä¼šæ›´å¤šåœ°è®¨è®ºå€Ÿç”¨ã€‚

### åˆ‡ç‰‡/Slices

åˆ‡ç‰‡ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªæ›´å¤§é›†åˆçš„è§†å›¾

```rust
fn main() {
    let a: [i32; 6] = [10, 20, 30, 40, 50, 60];
    println!("a: {a:?}");

    let s: &[i32] = &a[2..4];
    println!("s: {s:?}");
}
```

* åˆ‡ç‰‡ä»åˆ‡ç‰‡ç±»å‹ä¸­å€Ÿç”¨æ•°æ®
* æé—®:å¦‚æœä¿®æ”¹`a[3]`ä¼šæ€æ ·

#### String vs str

ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£Rustä¸­çš„ä¸¤ç§å­—ç¬¦ä¸²ç±»å‹:

```rust
fn main() {
    let s1: &str = "Hello";
    println!("s1: {s1}");

    let mut s2: String = String::from("Hello ");
    println!("s2: {s2}");
    s2.push_str(s1);
    println!("s2: {s2}");
}
```

Rust æœ¯è¯­ï¼š

* `&str`æ˜¯å¯¹å­—ç¬¦ä¸²ç‰‡çš„ä¸å¯å˜å¼•ç”¨ã€‚
* `String`æ˜¯å¯å˜å­—ç¬¦ä¸²ç¼“å†²åŒºã€‚

### å‡½æ•°/Functions

Rustç‰ˆçš„è‘—åçš„[FizzBuzz](https://en.wikipedia.org/wiki/Fizz_buzz)é¢è¯•é—®é¢˜ï¼š

```rust
fn main() {
    fizzbuzz_to(20);   // åœ¨ä¸‹é¢å®šä¹‰ï¼Œä¸éœ€è¦åœ¨å‰é¢å£°æ˜
}

fn is_divisible_by(lhs: u32, rhs: u32) -> bool {
    if rhs == 0 {
        return false;  // è¾¹ç•Œæƒ…å†µï¼Œæå‰è¿”å›
    }
    lhs % rhs == 0     // æœ€åä¸€ä¸ªè¡¨è¾¾å¼æ˜¯è¿”å›å€¼
}

fn fizzbuzz(n: u32) -> () {  // æ²¡æœ‰è¿”å›å€¼æ„å‘³ç€è¿”å›å•å…ƒç±»å‹ `()`
    match (is_divisible_by(n, 3), is_divisible_by(n, 5)) {
        (true,  true)  => println!("fizzbuzz"),
        (true,  false) => println!("fizz"),
        (false, true)  => println!("buzz"),
        (false, false) => println!("{n}"),
    }
}

fn fizzbuzz_to(n: u32) {  // `-> ()` é€šå¸¸çœç•¥
    for n in 1..=n {
        fizzbuzz(n);
    }
}
```

#### æ–¹æ³•/Methods

Rustæœ‰æ–¹æ³•ï¼Œå®ƒä»¬åªæ˜¯ä¸ç‰¹å®šç±»å‹ç›¸å…³è”çš„å‡½æ•°ã€‚æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸å…¶å…³è”çš„ç±»å‹çš„å®ä¾‹ï¼š

```rust
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.height
    }

    fn inc_width(&mut self, delta: u32) {
        self.width += delta;
    }
}

fn main() {
    let mut rect = Rectangle { width: 10, height: 5 };
    println!("old area: {}", rect.area());
    rect.inc_width(5);
    println!("new area: {}", rect.area());
}
```

#### å‡½æ•°é‡è½½

Rustä¸æ”¯æŒé‡è½½:

* æ¯ä¸ªå‡½æ•°éƒ½åªæœ‰ä¸€ä¸ªå®ç°:
  * æ€»æ˜¯æ¥å—å›ºå®šæ•°é‡çš„å‚æ•°ã€‚
  * å§‹ç»ˆæ¥å—ä¸€ç»„å‚æ•°ç±»å‹ã€‚
* ä¸æ”¯æŒé»˜è®¤å€¼:
  * æ‰€æœ‰è°ƒç”¨çš„åœ°æ–¹çš„å‚æ•°ä¸ªæ•°ç›¸åŒã€‚
  * å®æœ‰æ—¶è¢«ç”¨ä½œä¸€ç§æ›¿ä»£æ–¹æ³•ã€‚

ç„¶è€Œï¼Œå‡½æ•°å‚æ•°å¯ä»¥æ˜¯é€šç”¨çš„ï¼š

```rust
fn pick_one<T>(a: T, b: T) -> T {
    if std::process::id() % 2 == 0 { a } else { b }
}

fn main() {
    println!("coin toss: {}", pick_one("heads", "tails"));
    println!("cash prize: {}", pick_one(500, 1000));
}
```

## ç»ƒä¹ 1

åœ¨è¿™äº›ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢Rustçš„ä¸¤ä¸ªéƒ¨åˆ†:

* ç±»å‹ä¹‹é—´çš„éšå¼è½¬æ¢ã€‚
* æ•°ç»„å’Œ for å¾ªç¯ã€‚

### éšå¼è½¬å‹

Rustä¸ä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹ä¹‹é—´çš„éšå¼è½¬æ¢(ä¸c++ä¸åŒ)ã€‚ä½ å¯ä»¥åœ¨è¿™æ ·çš„ç¨‹åºä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼š

```rust
fn multiply(x: i16, y: i16) -> i16 {
    x * y
}

fn main() {
    let x: i8 = 15;
    let y: i16 = 1000;

    println!("{x} * {y} = {}", multiply(x, y));
                                     // ^  expected `i16`, found `i8`
}
```

Rustæ•´æ•°ç±»å‹éƒ½å®ç°äº†`From<T>`å’Œ`Into<T>`traits(ç¿»è¯‘ï¼šç‰¹æ€§)ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚`From<T>` traitæœ‰ä¸€ä¸ª`From()`æ–¹æ³•ï¼Œç±»ä¼¼åœ°ï¼Œ`Into<T>` traitæœ‰ä¸€ä¸ª`Into()`æ–¹æ³•ã€‚å®ç°è¿™äº›ç‰¹å¾æ˜¯ä¸€ç§ç±»å‹è¡¨ç¤ºå®ƒå¯ä»¥è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„æ–¹å¼ã€‚

æ ‡å‡†åº“æœ‰ä¸€ä¸ªç”¨äº`i16`çš„`From<i8>`å®ç°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨`i16::from(x)`å°†ç±»å‹ä¸º`i8`çš„å˜é‡xè½¬æ¢ä¸º`i16`ã€‚æˆ–è€…ï¼Œæ›´ç®€å•ä¸€ç‚¹ï¼Œä½¿ç”¨`x.into()`ï¼Œå› ä¸ºi16å®ç°çš„`From<i8>`ä¼šè‡ªåŠ¨ä¸º`i8`åˆ›å»º`Into<i16>`çš„å®ç°ã€‚

1. æ‰§è¡Œä¸Šé¢çš„ç¨‹åºå¹¶æŸ¥çœ‹ç¼–è¯‘å™¨é”™è¯¯ã€‚(æŠ¥é”™æˆ‘åœ¨ä¸Šé¢æ ‡å‡ºæ¥äº†)
2. æ›´æ–°ä¸Šé¢çš„ä»£ç ä»¥ä½¿ç”¨`into()`è¿›è¡Œè½¬æ¢ã€‚
3. å°†xå’Œyçš„ç±»å‹æ›´æ”¹ä¸ºå…¶ä»–ç±»å‹(ä¾‹å¦‚f32, bool, i128)ï¼Œä»¥æŸ¥çœ‹å“ªäº›ç±»å‹å¯ä»¥è½¬æ¢ä¸ºå…¶ä»–ç±»å‹ã€‚å°è¯•å°†å°ç±»å‹è½¬æ¢ä¸ºå¤§ç±»å‹ï¼Œæˆ–è€…åè¿‡æ¥è½¬æ¢ã€‚æ£€æŸ¥[æ ‡å‡†åº“æ–‡æ¡£](https://doc.rust-lang.org/std/convert/trait.From.html)ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¸ºæ‚¨æ£€æŸ¥çš„å¯¹å®ç°äº†`From<T>`ã€‚

### æ•°ç»„å’Œforå¾ªç¯

æˆ‘ä»¬çœ‹åˆ°æ•°ç»„å¯ä»¥è¿™æ ·å£°æ˜:

```rust
let array = [10, 20, 30];
```

ä½ å¯ä»¥é€šè¿‡ `{:?}` æ¥æ‰“å°æ•°ç»„:

```rust
fn main() {
    let array = [10, 20, 30];
    println!("array: {array:?}");
}
```

Rustå…è®¸æ‚¨ä½¿ç”¨`for`å…³é”®å­—è¿­ä»£æ•°ç»„å’ŒèŒƒå›´ç­‰å†…å®¹ï¼š

```rust
fn main() {
    let array = [10, 20, 30];
    print!("Iterating over array:");
    for n in array {
        print!(" {n}");
    }
    println!();

    print!("Iterating over range:");
    for i in 0..3 {
        print!(" {}", array[i]);
    }
    println!();
}
```

ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥å†™ä¸€ä¸ªå‡½æ•°`pretty_print`ï¼Œå®ƒå¯ä»¥æ¼‚äº®åœ°æ‰“å°ä¸€ä¸ªçŸ©é˜µï¼Œä»¥åŠä¸€ä¸ªå‡½æ•°transposeï¼Œå®ƒå°†è½¬ç½®ä¸€ä¸ªçŸ©é˜µ(å°†è¡Œè½¬æ¢ä¸ºåˆ—)ã€‚

```c
| 1 2 3 |    | 1 4 7 |
| 4 5 6 | => | 2 5 8 |
| 7 8 9 |    | 3 6 9 |
```

ç¡¬ç¼–ç ä¸¤ä¸ªå‡½æ•°æ“ä½œ3x3çŸ©é˜µã€‚

å¤åˆ¶ä¸‹é¢çš„ä»£ç åˆ° [https://play.rust-lang.org/](https://play.rust-lang.org/) å¹¶ä¸”å®ç°åŠŸèƒ½

```rust
// TODO: åœ¨å®Œæˆå®ç°ååˆ é™¤å®ƒã€‚
#![allow(unused_variables, dead_code)]

fn transpose(matrix: [[i32; 3]; 3]) -> [[i32; 3]; 3] {
    unimplemented!()
}

fn pretty_print(matrix: &[[i32; 3]; 3]) {
    unimplemented!()
}

fn main() {
    let matrix = [
        [101, 102, 103], // <-- è¯¥æ³¨é‡Šä¿è¯rustfmtè®©ä»£ç æ¢è¡Œ
        [201, 202, 203],
        [301, 302, 303],
    ];

    println!("matrix:");
    pretty_print(&matrix);

    let transposed = transpose(matrix);
    println!("transposed:");
    pretty_print(&transposed);
}
```

è¿™æ˜¯æˆ‘çš„ä½œä¸šç­”æ¡ˆï¼Œèªæ˜çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹æœ‰æ²¡æœ‰å€¼å¾—æ”¹è¿›çš„åœ°æ–¹ï¼š

```rust
fn transpose(matrix: [[i32; 3]; 3]) -> [[i32; 3]; 3] {
    let mut new_matrix: [[i32; 3]; 3] = [[0; 3]; 3];
    for i in 0..3 {
        for j in 0..3 {
            new_matrix[j][i] = matrix[i][j]
        }
    }
    new_matrix
}

fn pretty_print(matrix: &[[i32; 3]; 3]) {
    for i in 0..3 {
        print!("|");
        for j in 0..3 {
            print!(" {} ", matrix[i][j])
        }
        println!("|");
    }
}
```

#### é™„åŠ é¢˜

ä½ å¯ä»¥ä½¿ç”¨`&[i32]`ç‰‡ä»£æ›¿ç¡¬ç¼–ç çš„ 3 x 3 çŸ©é˜µä½œä¸ºå‚æ•°å’Œè¿”å›ç±»å‹å—?å¯¹äºäºŒç»´ç‰‡ä¸­çš„ç‰‡ï¼Œç±»ä¼¼äº`&[&[i32]]`ã€‚ä¸ºä»€ä¹ˆæˆ–ä¸ºä»€ä¹ˆä¸?

æœ‰å…³ç”Ÿäº§è´¨é‡å®ç°ï¼Œè¯·å‚é˜…[`ndarray` crate](https://docs.rs/ndarray/)ã€‚
